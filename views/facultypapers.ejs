<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>My Researches - ESSU Research and Information Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background-color: #e8f5e9;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: 
        
        url('data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2220%22 height=%2220%22 viewBox=%220 0 20 20%22%3E%3Cpath fill=%22%23e0e0e0%22 d=%22M0 0h2v2H0zm2 2h2v2H2zm2 2h2v2H4zm2 2h2v2H6zm2 2h2v2H8zm2 2h2v2H10zm2 2h2v2H12zm2 2h2v2H14z%22/%3E%3C/svg%3E') repeat;
    background-size: 450px, 30px 30px; /* Larger checkered pattern for a more refined look */
    background-position: center, 0 0; /* Logo stays centered, checkered pattern starts at the top */
    opacity: 0.9; /* Slightly faded to make it softer */
    z-index: -1; /* Place it behind other content */
    animation: fadeAnimation 15s ease-in-out infinite, moveCheckered 10s linear infinite; /* Fading + vertical move */
}

/* Keyframes for fading effect */
@keyframes fadeAnimation {
    0%, 100% { opacity: 0.9; } /* Keep the opacity at a subtle level */
    50% { opacity: 0.4; }   /* Faded in the middle for a smooth transition */
}

/* Keyframes for moving only the checkered pattern vertically */
@keyframes moveCheckered {
    0% { background-position: center, 0 0; }  /* Start at the top */
    100% { background-position: center, 0 100%; }  /* Move to the bottom */
}

        .header {
            background: linear-gradient(90deg, #008000, #66bb6a);
            color: white;
            padding: 0.75rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            width: 100%;
            top: 0;
            left: 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            font-size: 1rem;
        }
        .header .brand {
            font-size: 1.25rem;
            font-weight: 600;
        }
        .header .btn-profile,
        .header .btn-logout {
            background-color: #ffffff;
            color: #2e7d32;
            border: none;
            padding: 0.4rem 0.8rem;
            border-radius: 4px;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s;
            margin-right: 10px;
        }
        .header .btn-profile:hover,
        .header .btn-logout:hover {
            background-color: #f1f1f1;
            color: #2e7d32;
        }
        .header .btn-add-research {
            background-color: #ffffff;
            color: #2e7d32;
            border: none;
            padding: 0.4rem 0.8rem;
            border-radius: 4px;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s;
        }
        .header .btn-add-research:hover {
            background-color: #f1f1f1;
            color: #2e7d32;
        }
        .dashboard-container {
            display: flex;
            flex-grow: 1;
            margin-top: 60px;
        }
        .sidebar {
            width: 220px;
            background-color: #66bb6a;
            padding-top: 15px;
            position: fixed;
            top: 60px;
            left: 0;
            height: calc(100% - 60px);
            overflow-y: auto;
        }
        .sidebar a {
            display: block;
            color: white;
            padding: 0.8rem;
            text-decoration: none;
            font-size: 1rem;
            transition: background-color 0.3s ease;
        }
        .sidebar a:hover {
            background-color: #388e3c;
        }
        .main-content {
            margin-left: 220px;
            padding: 1rem;
            flex-grow: 1;
            width: calc(100% - 220px);
            font-size: 0.85rem;
        }
        .search-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .search-bar form {
            display: flex;
            align-items: center;
            width: 100%;
        }
        .input-group {
            display: flex;
            align-items: center;
            flex-grow: 1;
        }
        .d-flex {
            display: flex;
        }
        .ml-3 {
            margin-left: 1rem;
        }

        .research-table {
        table-layout: fixed; /* Prevent columns from resizing based on content */
        width: 100%; /* Maintain full width within the container */
        border-collapse: collapse;
        }

        .research-table th,
.research-table td {
    white-space: normal; /* Allow text to wrap */
    word-wrap: break-word; /* Break long words if needed */
    word-break: break-word; /* Break words at the end of the line if necessary */
}

.research-table th {
    background-color: #f8f9fa;
    font-weight: bold;
    padding: 10px; /* Add padding to th for better readability */
}

.research-table td {
    padding: 8px; /* Add padding to td for better readability */
}

        .barcode-cell {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .barcode {
            height: 40px;
            width: auto;
        }
        .button-group {
            display: flex;
            flex-direction: row;
            gap: 0.5rem;
        }
        .btn-edit,
        .btn-print {
            text-decoration: none;
            color: white;
            background-color: #007bff;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            text-align: center;
            white-space: nowrap;
        }
        .btn-edit:hover,
        .btn-print:hover {
            background-color: #0056b3;
        }
        footer {
            background-color: #2e7d32;
            color: white;
            padding: 1rem;
            text-align: center;
            position: relative;
            width: 100%;
        }
        .research-table td span {
            display: inline-block;
            white-space: nowrap;
            width: 100%;
            overflow-x: auto;
            max-width: 300px;
            padding-bottom: 2px;
        }
        .research-table td {
            max-width: 300px; /* Adjust as necessary */
            white-space: nowrap; /* Allow text wrapping */
            word-wrap: break-word; /* Break long words to fit within cell */
            overflow: auto; /* Ensure text is visible on scroll */
        }




            /* Adjust the "Researches" heading size */
        h1.my-4 {
            font-size: 1.5rem; /* Decreased from the default size */
            font-weight: bold;
            margin-bottom: 1.5rem;
        }


        /* Adjust the size and alignment of the "Upload New Research" button */
.mb-3.text-end .btn-success {
    font-size: 0.9rem; /* Make the font smaller */
    padding: 0.5rem 1rem; /* Reduce padding for a small button */
    border-radius: 4px; /* Round the corners */
    margin-left: auto; /* Automatically push the button to the right */
    margin-left: 0; /* Reset right margin */
    display: block; /* Ensure it takes the full width available for alignment */
    text-align: right; /* Align content to the right */
}


        .research-table th:first-child, 
        .research-table td:first-child {
            width: 5%; /* Adjust this value to make it smaller */
            text-align: center; /* Center align content for better appearance */
        }

        .research-table th:nth-child(4), 
        .research-table td:nth-child(4) {
            width: auto; /* Automatically adjusts width to fit content */
            max-width: 150px; /* Optional: Prevents it from growing too large */
            text-align: left; /* Centers the text for a neat look */
        }

        .research-table th:nth-child(5), 
        .research-table td:nth-child(5) {
            width: 100px; /* Automatically adjusts width to fit content */
            max-width: 150px; /* Optional: Prevents it from growing too large */
            text-align: left; /* Centers the text for a neat look */
        }
    </style>
    <style>
        #author-suggestions {
            list-style-type: none;
            padding: 0;
            margin: 0;
            border: 1px solid #ccc;
            position: absolute;
            width: max-content;
            background-color: white;
            z-index: 1000;
        }
        
        #author-suggestions .dropdown-item {
            padding: 5px 10px;
            cursor: pointer;
        }
        
        #author-suggestions .dropdown-item:hover {
            background-color: #f1f1f1;
        }
        
        .author-capsule {
            display: flex;
            align-items: center;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 20px;
            background-color: #f0f0f0;
            font-size: 14px;
        }
        
        .author-capsule button {
            background: none;
            border: none;
            color: red;
            cursor: pointer;
            font-size: 18px;
        }

        .modal-dialog {
    max-width: 90%; /* Adjust as needed */
}

    </style>
    <style>
        /* General Modal Styles */
.modal-body {
    padding: 2rem;
    background-color: #f9f9f9;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    font-family: Arial, sans-serif;
}

/* Form Labels */
.modal-body .form-label {
    font-weight: bold;
    color: #333;
    margin-bottom: 0.5rem;
    display: block;
}

/* Input Fields */
.modal-body .form-control {
    border: 1px solid #ccc;
    border-radius: 4px;
    padding: 0.5rem 0.75rem;
    font-size: 1rem;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
}

.modal-body .form-control:focus {
    border-color: #007bff;
    box-shadow: 0 0 4px rgba(0, 123, 255, 0.5);
}




/* Buttons */
.modal-footer .btn {
    padding: 0.5rem 1rem;
    font-size: 1rem;
    border-radius: 4px;
    transition: background-color 0.3s ease, color 0.3s ease;
}

.modal-footer .btn-primary {
    background-color: #007bff;
    color: #fff;
    border: none;
}

.modal-footer .btn-primary:hover {
    background-color: #0056b3;
}

.modal-footer .btn-secondary {
    background-color: #6c757d;
    color: #fff;
    border: none;
}

.modal-footer .btn-secondary:hover {
    background-color: #565e64;
}

/* Publication Date Group (Hidden Initially) */
#publication_date_group {
    display: none;
}

/* Responsive Design */
@media (max-width: 768px) {
    .modal-body {
        padding: 1rem;
    }

    .modal-footer .btn {
        font-size: 0.9rem;
        padding: 0.4rem 0.8rem;
    }
}

.pagination-controls {
    display: flex;
    justify-content: center;
    margin-top: 10px;
}

.pagination-controls .btn {
    margin: 0 5px;
}


    </style>
    <style>
        .aligned-container {
    display: flex;
    justify-content: space-between; /* Ensure separation between the two elements */
    align-items: center; /* Vertically align items */
    margin-bottom: 1rem; /* Add spacing below the container */
}

.aligned-container .btn-success {
    font-size: 0.9rem;
    padding: 0.5rem 1rem;
    border-radius: 4px;
}

.aligned-container .form-select {
    max-width: 200px; /* Adjust the width of the dropdown */
}

.scan-button {
            width: 200px;
            margin-left: 10px;
            font-size: 1rem;
            color: #ffffff;
            background-color: #388e3c;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .scan-button:hover {
            background-color: #2e7d32;
        }

    </style>
</head>
<body>

    <div class="header">
        <div class="brand">ESSU Research and Information Management System</div>
        <div class="d-flex">
            <span class="btn-profile" onclick="window.location.href='/facultyprofile'">Profile</span>
            <button class="btn-logout" onclick="window.location.href='/logout'">Logout</button>
        </div>
    </div>

    <div class="dashboard-container">
        <div class="sidebar">
            <a href="/facultydashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
            <a href="/facultypapers"><i class="fas fa-book"></i> Researches</a>
            
            
        </div>

        <div class="main-content">
            <div class="container">
                <h1 class="my-4">Researches</h1>
                <!-- Filter and Search Section -->
                <div class="d-flex align-items-center mb-4">
                    <!-- Search Bar -->
                    <form method="GET" action="/facultypapers" class="d-flex me-3">
                        <input 
                            type="text" 
                            name="search" 
                            class="form-control" 
                            placeholder="Search by Title, Author, or Description" 
                            value="<%= searchQuery || '' %>">
                        <button type="submit" class="btn btn-primary ms-2">Search</button>
                       
                        
                    </form>



 

            
                    
                    
                </div>
                <div class="aligned-container">
                    <div class="mb-3 text-end">
                        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#uploadResearchModal">
                            <i class="fas fa-plus"></i> Upload New Research
                        </button>
                    </div>
                    <div class="sortof">
                        <!-- Campus Sorting Dropdown -->
                        <form method="GET" action="/facultypapers">
                            <label for="status" class="visually-hidden">Filter by Status:</label>
                            <select name="status" id="status" class="form-select" onchange="this.form.submit()">
                                <option value="">All</option>
                                <% statuses.forEach(status => { %>
                                    <option value="<%= status.id %>" <%= status.id == statusFilter ? 'selected' : '' %>><%= status.name %></option>
                                <% }); %>
                            </select>
                        </form>
                    </div>

                </div>
        


               <!-- Modal Structure -->
<div class="modal fade" id="uploadResearchModal" tabindex="-1" aria-labelledby="uploadResearchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg"> <!-- Add modal-lg here for larger width -->
        <div class="modal-content">
            <div class="modal-header" style="background-color: #4CAF50; color: white;">
                <h5 class="modal-title" id="uploadResearchModalLabel">Add New Research</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form action="/fresearch/add" method="POST" enctype="multipart/form-data">
                    <div class="row">
                        <!-- Left Column -->
                        <div class="col-md-6 form-group mb-3">
                            <label for="title" class="form-label">Title</label>
                            <input type="text" name="title" id="title" class="form-control" required style="border-color: #4CAF50;">
                        </div>

                        <div class="col-md-6 form-group mb-3">
                            <label for="author" class="form-label">Author</label>
                            <input type="text" name="author" id="author" class="form-control" autocomplete="off" style="border-color: #4CAF50;">
                            <ul id="author-suggestions" class="dropdown-menu"></ul>
                        </div>

                        <input type="hidden" name="selected_authors" id="selected_authors">
                        <div id="selected-authors" class="mb-3"></div> <!-- Container for selected authors -->
                    </div>

                   <!-- Type of Research by Nature -->
                   
                        <div class="col-md-6 form-group mb-3">
                            <label for="nature" class="form-label">Type of Research by Nature</label>
                            <select name="nature" id="nature" class="form-control" style="border-color: #4CAF50;">
                                <option value="" disabled selected>Select type of research by nature</option>
                                <option value="Basic Research">Basic Research</option>
                                <option value="Applied Research">Applied Research</option>
                                <option value="Experimental Development">Experimental Development</option>
                                <option value="Theoretical Research">Theoretical Research</option>
                                <option value="Empirical Research">Empirical Research</option>
                            </select>
                        </div>

                        <div class="col-md-6 form-group mb-3">
                            <label for="origin" class="form-label">Type of Research by Source/Origin</label>
                            <select name="origin" id="origin" class="form-control" style="border-color: #4CAF50;">
                                <option value="" disabled selected>Select type of research by source/origin</option>
                                <option value="Internal">Internal</option>
                                <option value="External">External</option>
                            </select>
                        </div>
                    


                    <!-- Abstract (Shown for Ongoing, Completed, and Published) -->
                    <div class="row" id="abstract-row" style="display: none;">
                        <div class="col-md-6 form-group mb-3">
                            <label for="abstract" class="form-label">Abstract</label>
                            <textarea name="abstract" id="abstract" class="form-control" placeholder="Enter abstract here" style="border-color: #4CAF50;"></textarea>
                        </div>
                    </div>

                     <!-- Funding Source -->
                     <div class="row" id="fundingsource-row" style="display: none;">
                        <div class="col-md-6 form-group mb-3">
                            <label for="funding" class="form-label">Funding Source</label>
                            <select name="funding" id="funding" class="form-control" style="border-color: #4CAF50;">
                                <option value="" disabled selected>Select funding source</option>
                                <option value="Government">Government</option>
                                <option value="Private">Private</option>
                                <option value="University">University</option>
                                <option value="NGO">Non-Governmental Organization (NGO)</option>
                                <option value="International">International</option>
                            </select>
                        </div>
                    </div>

                    <!-- Journal Publication (Shown for Published) -->
                    <div class="row" id="journal-publication-row" style="display: none;">
                        <div class="col-md-6 form-group mb-3">
                            <label for="journal_publication" class="form-label">Journal Publication</label>
                            <input type="text" name="journal_publication" id="journal_publication" class="form-control" style="border-color: #4CAF50;">
                        </div>
                    </div>

                    <!-- Publication Date (Shown for Published) -->
                    <div class="row" id="publication-date-row" style="display: none;">
                        <div class="col-md-6 form-group mb-3">
                            <label for="publication_date" class="form-label">Publication Date</label>
                            <input type="date" name="publication_date" id="publication_date" class="form-control" style="border-color: #4CAF50;">
                        </div>
                    </div>

                   <!-- Project/Study Duration -->
                    <div class="row justify-content-center" id="duration-row" style="display: none;">
                        <div class="col-md-8" style="border: 1px solid #4CAF50; border-radius: 8px; padding: 15px;">
                            <div class="row">
                                <div class="col-12 form-group mb-3">
                                    <label for="duration" class="form-label">Project/Study Duration</label>
                                </div>
                                <div class="col-md-6 form-group mb-3">
                                    <label for="start" class="form-label">Start</label>
                                    <input type="date" name="start" id="start" class="form-control" style="border-color: #4CAF50;">
                                </div>
                                <div class="col-md-6 form-group mb-3">
                                    <label for="end" class="form-label">End</label>
                                    <input type="date" name="end" id="end" class="form-control" style="border-color: #4CAF50;">
                                </div>
                            </div>
                        </div>
                    </div>






                    

                    <!--  ISBN (Shown for Published) -->
                    <div class="row" id="isbn-row" style="display: none;">
                        <div class="col-md-6 form-group mb-3">
                            <label for="isbn" class="form-label">ISBN/ISSN</label>
                            <input type="text" name="isbn" id="isbn" class="form-control" style="border-color: #4CAF50;">
                        </div>
                    </div>


                   <!-- Keyword Input (Shown for Published) -->
                    <div class="row" id="keyword-row" style="display: none;">
                        <div class="col-md-12 form-group mb-3">
                            <label for="keyword-input" class="form-label">Keywords (Maximum 5)</label>
                            <div class="d-flex">
                                <input type="text" id="keyword-input" class="form-control me-2" placeholder="Enter a keyword" style="border-color: #4CAF50;">
                                <button type="button" id="add-keyword" class="btn btn-success">Add</button>
                            </div>
                            <small class="text-muted">Press "Add" to save each keyword.</small>
                            <ul id="keyword-list" class="mt-2" style="list-style-type: none; padding-left: 0;"></ul>
                        </div>
                    </div>

                <script>
                    const keywordInput = document.getElementById("keyword-input");
                    const addKeywordButton = document.getElementById("add-keyword");
                    const keywordList = document.getElementById("keyword-list");
                    const maxKeywords = 5;
                    let keywords = [];

                    addKeywordButton.addEventListener("click", () => {
                        const keyword = keywordInput.value.trim();
                        if (keyword === "") {
                            alert("Keyword cannot be empty.");
                            return;
                        }
                        if (keywords.length >= maxKeywords) {
                            alert(`You can only add up to ${maxKeywords} keywords.`);
                            return;
                        }
                        if (keywords.includes(keyword)) {
                            alert("This keyword has already been added.");
                            return;
                        }
                        keywords.push(keyword);
                        const listItem = document.createElement("li");
                        listItem.textContent = keyword;
                        listItem.className = "keyword-item d-flex justify-content-between align-items-center border p-2 mb-1 rounded";
                        listItem.style.borderColor = "#4CAF50";
                        const removeButton = document.createElement("button");
                        removeButton.textContent = "Remove";
                        removeButton.className = "btn btn-danger btn-sm";
                        removeButton.addEventListener("click", () => {
                            keywordList.removeChild(listItem);
                            keywords = keywords.filter(k => k !== keyword);
                        });
                        listItem.appendChild(removeButton);
                        keywordList.appendChild(listItem);
                        keywordInput.value = "";
                    });

                    // Select the form using querySelector (based on action attribute or other selector)
                    const form = document.querySelector('form[action="/fresearch/add"]'); // Select the form by its action URL

                    form.addEventListener('submit', (event) => {
                        event.preventDefault(); // Prevent the default form submission

                        // Join keywords into a comma-separated string
                        const keywordString = keywords.join(', ');

                        // If there are keywords, add them to a hidden input field
                        if (keywordString) {
                            const keywordField = document.createElement('input');
                            keywordField.type = 'hidden';
                            keywordField.name = 'keywords'; // Ensure this matches the name in the backend
                            keywordField.value = keywordString;
                            form.appendChild(keywordField); // Append the hidden field to the form
                        }

                        // Now submit the form with the updated keyword field
                        form.submit(); // This will now include the keywords as a comma-separated string
                    });
                </script>




                     

                    <!-- DOI (Shown for Published) -->
                    <div class="row" id="doi-row" style="display: none;">
                        <div class="col-md-6 form-group mb-3">
                            <label for="doi" class="form-label">DOI</label>
                            <input type="text" name="doi" id="doi" class="form-control" placeholder="Enter DOI (if available)" style="border-color: #4CAF50;">
                        </div>
                    </div>

                
                    <!-- Research File (Shown for Published) -->
                    <div class="form-group mb-3" id="research-file-row" style="display: none;">
                        <label for="researchFile" class="form-label">Research Document</label>
                        <input type="file" name="researchFile" id="researchFile" class="form-control" accept=".pdf,.doc,.docx" style="border-color: #4CAF50;">
                    </div>

                    

                    <!-- Status Selection -->
                    <div class="row">
                        <div class="col-md-6 form-group mb-3">
                            <label for="status_id" class="form-label">Status</label>
                            <select name="status_id" id="status_id" class="form-control" required onchange="toggleFields()" style="border-color: #4CAF50;">
                                <option value="4">Proposed</option>
                                <option value="2">Ongoing</option>
                                <option value="1">Completed</option>
                                <option value="3">Published</option>
                                
                            </select>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="background-color: #888;">Close</button>
                        <button type="submit" class="btn btn-primary" style="background-color: #4CAF50; border-color: #4CAF50;">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    function toggleFields() {
        const status = document.getElementById('status_id').value;
        
        // Reset the display of fields
        document.getElementById('abstract-row').style.display = 'none';
        document.getElementById('journal-publication-row').style.display = 'none';
        document.getElementById('publication-date-row').style.display = 'none';
        document.getElementById('isbn-row').style.display = 'none';
        document.getElementById('duration-row').style.display = 'none';
        document.getElementById('doi-row').style.display = 'none';
        document.getElementById('research-file-row').style.display = 'none';
        document.getElementById('fundingsource-row').style.display = 'none';
        document.getElementById('keyword-row').style.display = 'none';

       
       

        // Show fields based on status selection
        if (status === '1') {  // Ongoing or Completed
            document.getElementById('abstract-row').style.display = 'block';
            document.getElementById('fundingsource-row').style.display = 'block';
            document.getElementById('research-file-row').style.display = 'block';
            document.getElementById('duration-row').style.display = 'block';
            document.getElementById('keyword-row').style.display = 'block';
            
            
        }

          // Show fields based on status selection
          if (status === '2') {  // Ongoing or Completed
            document.getElementById('abstract-row').style.display = 'block';
            document.getElementById('fundingsource-row').style.display = 'block';
            document.getElementById('duration-row').style.display = 'block';
            document.getElementById('keyword-row').style.display = 'block';
        }
        
        if (status === '3') {  // Published
            document.getElementById('abstract-row').style.display = 'block';
            document.getElementById('journal-publication-row').style.display = 'block';
            document.getElementById('publication-date-row').style.display = 'block';
            document.getElementById('isbn-row').style.display = 'block';
            document.getElementById('doi-row').style.display = 'block';
            document.getElementById('fundingsource-row').style.display = 'block';
            document.getElementById('research-file-row').style.display = 'block';
            document.getElementById('duration-row').style.display = 'block';
            document.getElementById('keyword-row').style.display = 'block';

            
        }
        if (status === '4') {  // Proposed
            // Only title, author, and status fields will be shown
        }
    }

    // Initialize field visibility on page load
    window.onload = function() {
        toggleFields(); // Ensure correct fields are displayed on initial load
    };
</script>


                
                
                

         <!-- Modal for editing research -->
<div class="modal fade" id="editResearchModal" tabindex="-1" aria-labelledby="editResearchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editResearchModalLabel">Edit Research</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="/update-paper" method="POST" enctype="multipart/form-data">
                <div class="modal-body">
                    <!-- Hidden input for researchId -->
                    <input type="hidden" id="researchId" name="id">
                    <input type="hidden" id="author_id" name="author_id"> <!-- Hidden input for author_id -->
                    
                    <!-- Two-column layout using Bootstrap grid system -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="title" class="form-label">Research Title</label>
                                <input type="text" class="form-control" id="title" name="title" required>
                            </div>
                            <div class="mb-3">
                                <label for="abstract" class="form-label">Abstract</label>
                                <textarea class="form-control" id="abstract" name="abstract" required></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="author" class="form-label">Author</label>
                                <input type="text" class="form-control" id="author" name="author" required disabled> <!-- Disable text input -->
                            </div>
                            <div class="mb-3">
                                <label for="publication_date" class="form-label">Publication Date</label>
                                <input type="date" class="form-control" id="publication_date" name="publication_date" required>
                            </div>
                            <div class="mb-3">
                                <label for="journal_publication" class="form-label">Journal Publication</label>
                                <input type="text" class="form-control" id="journal_publication" name="journal_publication" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="status_id" class="form-label">Current Phase</label>
                                <input type="text" class="form-control" id="status_id" name="status_id" readonly style="background-color: #e9ecef; color: #6c757d; border: 1px solid #d6d8db;">
                            </div>

                            <div class="mb-3">
                                <label for="status" class="form-label">Next Phase</label>
                                <input type="text" class="form-control" id="status" name="status" value="Published" readonly style="background-color: #e9ecef; color: #6c757d; border: 1px solid #d6d8db;">
                            </div>
                            
                            <div class="mb-3">
                                <label for="doi" class="form-label">DOI</label>
                                <input type="text" class="form-control" id="doi" name="doi">
                            </div>
                            <div class="mb-3">
                                <label for="funding" class="form-label">Funding</label>
                                <input type="text" class="form-control" id="funding" name="funding">
                            </div>
                            <div class="mb-3">
                                <label for="nature" class="form-label">Nature</label>
                                <input type="text" class="form-control" id="nature" name="nature">
                            </div>
                            <div class="mb-3">
                                <label for="origin" class="form-label">Origin</label>
                                <input type="text" class="form-control" id="origin" name="origin">
                            </div>
                            <div class="mb-3">
                                <label for="isbn" class="form-label">ISBN</label>
                                <input type="text" class="form-control" id="isbn" name="isbn">
                            </div>
                            <div class="mb-3">
                                <label for="startdate" class="form-label">Start Date</label>
                                <input type="date" class="form-control" id="startdate" name="startdate">
                            </div>
                            <div class="mb-3">
                                <label for="enddate" class="form-label">End Date</label>
                                <input type="date" class="form-control" id="enddate" name="enddate">
                            </div>
                            <div class="mb-3">
                                <label for="keyword" class="form-label">Keyword</label>
                                <input type="text" class="form-control" id="keyword" name="keyword">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Research File (Shown for Published) -->
                    <div class="form-group mb-3">
                        <label for="researchFile" class="form-label">Upload published manuscript</label>
                        <input type="file" name="researchFile" id="researchFile" class="form-control" accept=".pdf,.doc,.docx" style="border-color: #4CAF50;">
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                </div>
            </form>
        </div>
    </div>
</div>



<!-- Modal for editing research -->
<div class="modal fade" id="ongoingUpdate" tabindex="-1" aria-labelledby="ongoingUpdateLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="ongoingUpdateLabel">Edit Research</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="/update-paper" method="POST" enctype="multipart/form-data">
                <div class="modal-body">
                    <input type="hidden" id="researchId" name="id">
                    <input type="hidden" id="author_id" name="author_id"> <!-- Hidden input for author_id -->
                
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="title" class="form-label">Research Title</label>
                            <input type="text" class="form-control" id="title" name="title" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="author" class="form-label">Author</label>
                            <input type="text" class="form-control" id="author" name="author" required disabled> <!-- Disable text input -->
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="abstract" class="form-label">Abstract</label>
                        <textarea class="form-control" id="abstract" name="abstract" required></textarea>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="status_id" class="form-label">Current Phase</label>
                            <input type="text" class="form-control" id="status_id" name="status_id" readonly style="background-color: #e9ecef; color: #6c757d; border: 1px solid #d6d8db;">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="status" class="form-label">Next Phase</label>
                            <input type="text" class="form-control" id="status" name="status" value="Ongoing" readonly style="background-color: #e9ecef; color: #6c757d; border: 1px solid #d6d8db;">
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="funding" class="form-label">Funding</label>
                            <input type="text" class="form-control" id="funding" name="funding">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="nature" class="form-label">Nature</label>
                            <input type="text" class="form-control" id="nature" name="nature">
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="origin" class="form-label">Origin</label>
                            <input type="text" class="form-control" id="origin" name="origin">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="startdate" class="form-label">Start Date</label>
                            <input type="date" class="form-control" id="startdate" name="startdate">
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="enddate" class="form-label">End Date</label>
                            <input type="date" class="form-control" id="enddate" name="enddate">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="keyword" class="form-label">Keyword</label>
                            <input type="text" class="form-control" id="keyword" name="keyword">
                        </div>
                    </div>

                    <!-- Research File (Shown for Published) -->
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                </div>
            </form>
        </div>
    </div>
</div>


<!-- Modal for editing research -->
<div class="modal fade" id="completeUpdate" tabindex="-1" aria-labelledby="completeUpdateLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="completeUpdateLabel">Edit Research</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="/update-paper" method="POST" enctype="multipart/form-data">
                <div class="modal-body">
                    <input type="hidden" id="researchId" name="id">
                    <input type="hidden" id="author_id" name="author_id"> <!-- Hidden input for author_id -->

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="title" class="form-label">Research Title</label>
                                <input type="text" class="form-control" id="title" name="title" required>
                            </div>
                            <div class="mb-3">
                                <label for="abstract" class="form-label">Abstract</label>
                                <textarea class="form-control" id="abstract" name="abstract" required></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="author" class="form-label">Author</label>
                                <input type="text" class="form-control" id="author" name="author" required disabled> <!-- Disable text input -->
                            </div>
                            <div class="mb-3">
                                <label for="status_id" class="form-label">Current Phase</label>
                                <input type="text" class="form-control" id="status_id" name="status_id" readonly style="background-color: #e9ecef; color: #6c757d; border: 1px solid #d6d8db;">
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="status" class="form-label">Next Phase</label>
                                <input type="text" class="form-control" id="status" name="status" value="Completed" readonly style="background-color: #e9ecef; color: #6c757d; border: 1px solid #d6d8db;">
                            </div>
                            <div class="mb-3">
                                <label for="funding" class="form-label">Funding</label>
                                <input type="text" class="form-control" id="funding" name="funding">
                            </div>
                            <div class="mb-3">
                                <label for="nature" class="form-label">Nature</label>
                                <input type="text" class="form-control" id="nature" name="nature">
                            </div>
                            <div class="mb-3">
                                <label for="origin" class="form-label">Origin</label>
                                <input type="text" class="form-control" id="origin" name="origin">
                            </div>
                            <div class="mb-3">
                                <label for="startdate" class="form-label">Start Date</label>
                                <input type="date" class="form-control" id="startdate" name="startdate">
                            </div>
                            <div class="mb-3">
                                <label for="enddate" class="form-label">End Date</label>
                                <input type="date" class="form-control" id="enddate" name="enddate">
                            </div>
                            <div class="mb-3">
                                <label for="keyword" class="form-label">Keyword</label>
                                <input type="text" class="form-control" id="keyword" name="keyword">
                            </div>
                            <div class="form-group mb-3">
                                <label for="researchFile" class="form-label">Upload complete manuscript</label>
                                <input type="file" name="researchFile" id="researchFile" class="form-control" accept=".pdf,.doc,.docx" style="border-color: #4CAF50;">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                </div>
            </form>
        </div>
    </div>
</div>








<script>
    // Listen for the 'show.bs.modal' event to populate the modal fields
    document.getElementById('editResearchModal').addEventListener('show.bs.modal', function (event) {
        var button = event.relatedTarget; // Button that triggered the modal
        var researchId = button.getAttribute('data-id');
        var title = button.getAttribute('data-title');
        var author = button.getAttribute('data-author');
        var abstract = button.getAttribute('data-abstract');
        var publicationDate = button.getAttribute('data-publication_date');
        var journalPublication = button.getAttribute('data-journal_publication');
        var statusName = button.getAttribute('data-status');
        var doi = button.getAttribute('data-doi');
        var funding = button.getAttribute('data-funding');
        var nature = button.getAttribute('data-nature');
        var origin = button.getAttribute('data-origin');
        var isbn = button.getAttribute('data-isbn');
        var startdate = button.getAttribute('data-startdate');
        var enddate = button.getAttribute('data-enddate');
        var keyword = button.getAttribute('data-keyword');
        var filename = button.getAttribute('data-filename');
        
        // Set modal title dynamically
        var modalTitle = document.querySelector('#editResearchModal .modal-title');
        modalTitle.innerHTML = `Edit Research: ${title} <br> Current Status: ${statusName}`;

        // Populate the modal fields with the data from the button
        var modalBody = document.querySelector('#editResearchModal .modal-body');

        modalBody.querySelector('#researchId').value = researchId;
        modalBody.querySelector('#title').value = title;
        modalBody.querySelector('#author').value = author;
        modalBody.querySelector('#abstract').value = abstract;
        modalBody.querySelector('#publication_date').value = publicationDate;
        modalBody.querySelector('#journal_publication').value = journalPublication;
        modalBody.querySelector('#status_id').value = statusName; // For read-only
        modalBody.querySelector('#doi').value = doi;
        modalBody.querySelector('#funding').value = funding;
        modalBody.querySelector('#nature').value = nature;
        modalBody.querySelector('#origin').value = origin;
        modalBody.querySelector('#isbn').value = isbn;
        modalBody.querySelector('#startdate').value = startdate;
        modalBody.querySelector('#enddate').value = enddate;
        modalBody.querySelector('#keyword').value = keyword;
        modalBody.querySelector('#filename').value = filename;
    });
</script>


<script>
    document.getElementById('ongoingUpdate').addEventListener('show.bs.modal', function (event) {
        var button = event.relatedTarget; // Button that triggered the modal
        var researchId = button.getAttribute('data-id');
        var title = button.getAttribute('data-title');
        var author = button.getAttribute('data-author');
        var abstract = button.getAttribute('data-abstract');
        var statusName = button.getAttribute('data-status');
        var funding = button.getAttribute('data-funding');
        var nature = button.getAttribute('data-nature');
        var origin = button.getAttribute('data-origin');
        var startdate = button.getAttribute('data-startdate');
        var enddate = button.getAttribute('data-enddate');
        var keyword = button.getAttribute('data-keyword');
        var modalTitle = document.querySelector('#ongoingUpdateLabel');
        var modalBody = document.querySelector('#ongoingUpdate .modal-body');

        modalTitle.innerHTML = `Edit Research: ${title} <br> Current Status: ${statusName}`;
        modalBody.querySelector('#status_id').value = statusName;
        modalBody.querySelector('#researchId').value = researchId;
        modalBody.querySelector('#title').value = title;
        modalBody.querySelector('#author').value = author;
        modalBody.querySelector('#abstract').value = abstract;
        modalBody.querySelector('#funding').value = funding;
        modalBody.querySelector('#nature').value = nature;
        modalBody.querySelector('#origin').value = origin;
        modalBody.querySelector('#startdate').value = startdate;
        modalBody.querySelector('#enddate').value = enddate;
        modalBody.querySelector('#keyword').value = keyword;
    });
</script>

<script>
    document.getElementById('completeUpdate').addEventListener('show.bs.modal', function (event) {
        var button = event.relatedTarget; // Button that triggered the modal
        var researchId = button.getAttribute('data-id');
        var title = button.getAttribute('data-title');
        var author = button.getAttribute('data-author');
        var abstract = button.getAttribute('data-abstract');
        var statusName = button.getAttribute('data-status');
        var funding = button.getAttribute('data-funding');
        var nature = button.getAttribute('data-nature');
        var origin = button.getAttribute('data-origin');
        var startdate = button.getAttribute('data-startdate');
        var enddate = button.getAttribute('data-enddate');
        var keyword = button.getAttribute('data-keyword');
        
        var modalTitle = document.querySelector('#completeUpdateLabel');
        var modalBody = document.querySelector('#completeUpdate .modal-body');

        modalTitle.innerHTML = `Edit Research: ${title} <br> Current Status: ${statusName}`;

        modalBody.querySelector('#researchId').value = researchId;
        modalBody.querySelector('#status_id').value = statusName;
        modalBody.querySelector('#title').value = title;
        modalBody.querySelector('#author').value = author;
        modalBody.querySelector('#abstract').value = abstract;
        modalBody.querySelector('#funding').value = funding;
        modalBody.querySelector('#nature').value = nature;
        modalBody.querySelector('#origin').value = origin;
        modalBody.querySelector('#startdate').value = startdate;
        modalBody.querySelector('#enddate').value = enddate;
        modalBody.querySelector('#keyword').value = keyword;
    });
</script>






                            


<!-- Modal for Viewing Research Details -->
<div class="modal fade" id="viewResearchModal" tabindex="-1" aria-labelledby="viewResearchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content shadow-lg rounded-4 border-0">
            <div class="modal-header border-bottom-0">
                <h5 class="modal-title text-light" id="viewResearchModalLabel">View Research</h5>
                <!-- Print Button -->
                <button type="button" class="btn btn-light btn-sm" id="printModalContent" title="Print">
                    <i class="bi bi-printer"></i>
                </button>
            </div>
            <div class="modal-body px-4 py-3">
                <!-- Barcode Image Display at Top Right -->
                <div class="d-flex justify-content-end mb-4">
                    <img id="view-barcode-image" src="" alt="Barcode Image" class="shadow-sm" style="max-width: 150px; height: auto;" />
                </div>

                <!-- Two-column layout for details -->
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <p><strong class="text-muted">Title:</strong> <span id="view-title" class="text-dark"></span></p>
                        </div>
                        <div class="mb-3">
                            <p><strong class="text-muted">Author:</strong> <span id="view-author" class="text-dark"></span></p>
                        </div>
                        <div class="mb-3">
                            <p><strong class="text-muted">Campus:</strong> <span id="view-campus" class="text-dark"></span></p>
                        </div>
                        <div class="mb-3">
                            <p><strong class="text-muted">Publication Date:</strong> <span id="view-publication-date" class="text-dark"></span></p>
                        </div>
                        <div class="mb-3">
                            <p><strong class="text-muted">Journal Publication:</strong> <span id="view-journal-publication" class="text-dark"></span></p>
                        </div>
                        <div class="mb-3">
                            <p><strong class="text-muted">Status:</strong> <span id="view-status" class="text-dark"></span></p>
                        </div>
                        <div class="mb-3">
                            <p><strong class="text-muted">DOI:</strong> <span id="view-doi" class="text-dark"></span></p>
                        </div>
                        <div class="mb-3">
                            <p><strong class="text-muted">Abstract:</strong> <span id="view-abstract" class="text-dark"></span></p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <p><strong class="text-muted">Funding:</strong> <span id="view-funding" class="text-dark"></span></p>
                        </div>
                        <div class="mb-3">
                            <p><strong class="text-muted">Nature:</strong> <span id="view-nature" class="text-dark"></span></p>
                        </div>
                        <div class="mb-3">
                            <p><strong class="text-muted">Origin:</strong> <span id="view-origin" class="text-dark"></span></p>
                        </div>
                        <div class="mb-3">
                            <p><strong class="text-muted">ISBN/ISSN:</strong> <span id="view-isbn" class="text-dark"></span></p>
                        </div>
                        <div class="mb-3">
                            <p><strong class="text-muted">Start Date:</strong> <span id="view-startdate" class="text-dark"></span></p>
                        </div>
                        <div class="mb-3">
                            <p><strong class="text-muted">End Date:</strong> <span id="view-enddate" class="text-dark"></span></p>
                        </div>
                        <div class="mb-3">
                            <p><strong class="text-muted">Keywords:</strong> <span id="view-keyword" class="text-dark"></span></p>
                        </div>
                        <div class="mb-3">
                            <p><strong class="text-muted">Filename:</strong> <span id="view-filename" class="text-dark"></span></p>
                        </div>
                    </div>
                </div>

                <!-- PDF Preview -->
                <div class="pdf-preview mt-4">
                    <embed 
                        id="pdf-preview" 
                        type="application/pdf" 
                        width="100%" 
                        height="500px" 
                        style="border: none;" 
                        title="PDF Preview">
                </div>
            </div>
            <div class="modal-footer border-top-0 d-flex justify-content-end">
                <button type="button" class="btn btn-outline-light px-4 py-2" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<script>
    // Populate the modal with the research data
    document.getElementById('viewResearchModal').addEventListener('show.bs.modal', function (event) {
        var button = event.relatedTarget; // Button that triggered the modal

        // Get filename from the button's data attribute
        var filename = button.getAttribute('data-filename');

        // Update filename text
        document.getElementById('view-filename').textContent = filename;

        // Update PDF preview source
        var pdfPreview = document.getElementById('pdf-preview');
        if (filename) {
            pdfPreview.src = "/uploads/" + filename;
        } else {
            pdfPreview.src = ""; // Clear the preview if no filename
            console.error("Filename is missing or invalid.");
        }
    });
</script>


<script>
  // Function to format the publication date
function formatDate(dateString) {
    if (!dateString || isNaN(Date.parse(dateString))) {
        return 'Not published yet'; // Return this if the date is not available or invalid
    }

    const options = { year: 'numeric', month: 'long', day: 'numeric' };
    const date = new Date(dateString);
    return date.toLocaleDateString('en-US', options);
}

// Print only the selected content
document.getElementById('printModalContent').addEventListener('click', function () {
    // Create a hidden iframe
    var iframe = document.createElement('iframe');
    iframe.style.position = 'absolute';
    iframe.style.top = '-10000px'; // Hide it off-screen
    document.body.appendChild(iframe);

    // Get the iframe's document
    var doc = iframe.contentDocument || iframe.contentWindow.document;

    // Create the printable content
    var barcode = document.getElementById('view-barcode-image').outerHTML;
    
    // Make the barcode a reasonable size by adding style
    barcode = barcode.replace('<img', '<img style="width: 200px; height: 50px;"');  // Adjust width and height as needed

    var campus = '<p style="font-size: 18px; margin-bottom: 60px; line-height: 1.5;">' + document.getElementById('view-campus').textContent + '</p>';
    var title = '<p style="font-size: 26px; font-weight: bold; margin-bottom: 60px; line-height: 1.5;">' + document.getElementById('view-title').textContent + '</p>';
    var journal = '<p style="font-size: 18px; margin-bottom: 60px; line-height: 1.5;">' + document.getElementById('view-journal-publication').textContent + '</p>';
    var author = '<p style="font-size: 18px; margin-bottom: 60px; line-height: 1.5;">' + document.getElementById('view-author').textContent + '</p>';
    var publicationDate = '<p style="font-size: 18px; margin-bottom: 60px; line-height: 1.5;">' + formatDate(document.getElementById('view-publication-date').textContent) + '</p>';

    // Combine the content into a printable format
    var printContent = `
        <div style="padding: 60px; font-family: Arial, sans-serif; width: 100%; height: 100%; box-sizing: border-box;">
            <div style="position: absolute; top: 20px; right: 20px;">
                ${barcode}
            </div>
            <div style="margin-top: 250px; text-align: center;">
                ${campus}
                ${title}
                ${journal}
                ${author}
                ${publicationDate}
            </div>
        </div>
    `;

    // Write the content into the iframe
    doc.open();
    doc.write('<html><head><title>Print</title></head><body>');
    doc.write(printContent);
    doc.write('</body></html>');
    doc.close();

    // Trigger the print
    iframe.contentWindow.focus();
    iframe.contentWindow.print();

    // Remove the iframe after printing
    setTimeout(() => document.body.removeChild(iframe), 1000);
});


</script>



<style>
    /* Contemporary green-themed modal design */
    .modal-content {
        background-color: #eafaf1;
        color: #333;
        border-radius: 12px;
    }
    .modal-header {
        background-color: #3b9a56; /* Soft green */
        color: #fff;
        border-radius: 12px 12px 0 0;
    }
    .modal-title {
        font-size: 1.6rem;
        font-weight: 600;
    }
    .modal-body {
        background-color: #ffffff;
        padding: 30px;
        border-radius: 8px;
    }
    .modal-footer {
        background-color: #f7f7f7;
        padding: 20px;
        border-radius: 0 0 12px 12px;
    }
    .btn-outline-light {
        border-color: #3b9a56;
        color: #3b9a56;
        font-weight: 500;
    }
    .btn-outline-light:hover {
        background-color: #3b9a56;
        color: #fff;
    }
    .text-muted {
        color: #6c757d;
    }
    .text-dark {
        color: #343a40;
    }
    .shadow-sm {
        box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
    }
</style>




        
<table id="research-table" class="table table-striped table-bordered research-table">
    <thead>
        <tr>
            <th>#</th>
            <th>Title</th>
            <th>Author</th>
            <th>Date Uploaded</th>
            <th>Publication Date</th>
            <th>Journal Publication</th>
            <th>Status</th>
            <th>Actions</th> <!-- New column for actions -->
        </tr>
    </thead>
    <tbody id="research-table-body">
        <% researches.forEach((research, index) => { %>
            <tr>
                <td><%= index + 1 %></td>
                <td><%= research.title %></td>
                <td><%= research.author_name %></td>
                <td>
                    <%= new Date(research.date_uploaded).toLocaleDateString('en-US', { 
                        month: 'long', 
                        day: 'numeric', 
                        year: 'numeric' 
                    }) %>
                </td>
                <td><%= research.publication_date %></td>
                <td><%= research.journal_publication %></td>
                <td><%= research.status || 'Pending' %></td>
                <td> <!-- New column for buttons -->
                    <!-- View Button (could trigger a modal or redirect to a details page) -->
                    <button class="btn btn-info btn-sm" 
                        data-bs-toggle="modal" 
                        data-bs-target="#viewResearchModal" 
                        data-id="<%= research.id %>" 
                        data-title="<%= research.title %>" 
                        data-author="<%= research.author_name %>" 
                        data-publication_date="<%= research.publication_date %>" 
                        data-journal_publication="<%= research.journal_publication %>" 
                        data-status="<%= research.status %>" 
                        data-barcode="<%= research.barcode %>" 
                        data-barnum="<%= research.barnum %>" 
                        data-doi="<%= research.doi %>" 
                        data-abstract="<%= research.abstract %>"
                        data-funding="<%= research.funding %>"
                        data-nature="<%= research.nature %>"
                        data-origin="<%= research.origin %>"
                        data-isbn="<%= research.isbn %>"
                        data-startdate="<%= research.startdate %>"
                        data-enddate="<%= research.enddate %>"
                        data-keyword="<%= research.keyword %>"
                        data-filename="<%= research.filename %>"
                        data-campus="ESSU MAIN">
                        View
                    </button>
                
                    <!-- Conditionally Render Edit Button -->
                    <% let buttonText = ''; %>
                    <% let modalTarget = ''; %>
                    
                    <% if (research.status === 'Proposed') { %>
                        <% buttonText = 'Continue'; %>
                        <% modalTarget = '#ongoingUpdate'; %>
                    <% } else if (research.status === 'Ongoing') { %>
                        <% buttonText = 'Complete'; %>
                        <% modalTarget = '#completeUpdate'; %>
                    <% } else if (research.status === 'Completed') { %>
                        <% buttonText = 'Publish'; %>
                        <% modalTarget = '#editResearchModal'; %>
                    <% } %>
                
                    <!-- Add condition to hide button when status is 'Published' -->
                    <% if (research.status !== 'Published') { %>
                        <button class="btn btn-warning btn-sm" 
                            data-bs-toggle="modal" 
                            data-bs-target="<%= modalTarget %>" 
                            data-id="<%= research.id %>" 
                            data-title="<%= research.title %>" 
                            data-author="<%= research.author_name %>" 
                            data-publication_date="<%= research.publication_date %>" 
                            data-journal_publication="<%= research.journal_publication %>" 
                            data-status="<%= research.status %>" 
                            data-barcode="<%= research.barcode %>" 
                            data-barnum="<%= research.barnum %>" 
                            data-doi="<%= research.doi %>" 
                            data-abstract="<%= research.abstract %>"
                            data-funding="<%= research.funding %>"
                            data-nature="<%= research.nature %>"
                            data-origin="<%= research.origin %>"
                            data-isbn="<%= research.isbn %>"
                            data-startdate="<%= research.startdate %>"
                            data-enddate="<%= research.enddate %>"
                            data-keyword="<%= research.keyword %>"
                            data-filename="<%= research.filename %>">
                            <%= buttonText %>
                        </button>
                    <% } %>
                </td>
                
            </tr>
        <% }); %>
    </tbody>
</table>


                
                
                
                <div class="pagination-controls">
                    <button id="prev-btn" class="btn btn-secondary" disabled>Previous</button>
                    <button id="next-btn" class="btn btn-secondary">Next</button>
                </div>
                
            </div>
        </div>
    </div>


    <script>
        function printResearchCover(campus, title, author, journalPublication, publicationDate, barcode) {
    const printWindow = window.open('', '_blank'); // Open a new window for printing

    // Create the content for the front page cover
    const content = `
        <html>
            <head>
                <style>
                    body {
                        font-family: Arial, sans-serif;
                        text-align: center;
                        margin: 0;
                        padding: 0;
                        display: flex;
                        flex-direction: column;
                        justify-content: center;
                        height: 100vh; /* Ensure content occupies the full height of the paper */
                    }
                    .container {
                        padding: 0 20px;
                    }
                    h1 {
                        font-size: 2.5em; /* Larger font size for title */
                        font-weight: bold; /* Make title bold */
                        margin: 40px 0;
                    }
                    h2, h3, p {
                        font-size: 1.2em;
                        margin: 20px 0;
                    }
                    .barcode {
                        margin-top: 50px;
                    }
                    .barcode img {
                        width: 150px; /* Adjust the width */
                        height: auto; /* Maintain aspect ratio */
                    }
                </style>
            </head>
            <body>
                <div class="container">
                    <h2>${campus}</h2>
                    <h1>${title}</h1>
                    <h3>${author}</h3>
                    <p>${journalPublication}</p>
                    <p>${publicationDate}</p>
                    <div class="barcode">
                        <img src="data:image/png;base64,${barcode}" alt="Barcode">
                    </div>
                </div>
            </body>
        </html>
    `;

    // Write content to the new window and print
    printWindow.document.write(content);
    printWindow.document.close();
    printWindow.focus();
    printWindow.print();
    printWindow.close();
}




    </script>

    


    
    


    <script>
        const rowsPerPage = 10; // Number of entries per page
        let currentPage = 1; // Current page number
        const tableBody = document.getElementById('research-table-body');
        const rows = Array.from(tableBody.querySelectorAll('tr'));
        const totalPages = Math.ceil(rows.length / rowsPerPage);
    
        // Function to display the current page
        function displayPage(page) {
            // Hide all rows
            rows.forEach((row, index) => {
                row.style.display = 'none';
            });
    
            // Show rows for the current page
            const start = (page - 1) * rowsPerPage;
            const end = start + rowsPerPage;
            rows.slice(start, end).forEach(row => {
                row.style.display = '';
            });
    
            // Update button states
            document.getElementById('prev-btn').disabled = page === 1;
            document.getElementById('next-btn').disabled = page === totalPages;
        }
    
        // Event listeners for buttons
        document.getElementById('prev-btn').addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                displayPage(currentPage);
            }
        });
    
        document.getElementById('next-btn').addEventListener('click', () => {
            if (currentPage < totalPages) {
                currentPage++;
                displayPage(currentPage);
            }
        });
    
        // Initialize the first page
        displayPage(currentPage);
    </script>
    

    <script>
        // Function to toggle the visibility and requirement of the Publication Date field
        function togglePublicationDate() {
            const status = document.getElementById('status_id').value;
            const publicationDateGroup = document.getElementById('publication_date_group');
            const publicationDateField = document.getElementById('publication_date');
            
            if (status === "3") {  // "Published" status
                publicationDateGroup.style.display = "block";  // Show the Publication Date field
                publicationDateField.setAttribute("required", "required");  // Make it required
            } else {
                publicationDateGroup.style.display = "none";  // Hide the Publication Date field
                publicationDateField.removeAttribute("required");  // Remove the required attribute
            }
        }

        // Call the function on page load to set the initial state based on the selected status
        window.onload = togglePublicationDate;
    </script>


    <script>
        let authorsSelected = []; // Array to track selected authors
        let authorsData = []; // Array to store author objects

        document.getElementById('author').addEventListener('input', async function() {
            const query = this.value;
            if (query.length > 1) {
                try {
                    const response = await fetch(`/authors/suggestions?query=${encodeURIComponent(query)}`);
                    const authors = await response.json();
                    
                    authorsData = authors; // Store the data for reference

                    const suggestionsList = document.getElementById('author-suggestions');
                    suggestionsList.innerHTML = '';
                    
                    authors.forEach(author => {
                        const listItem = document.createElement('li');
                        listItem.classList.add('dropdown-item');
                        listItem.style.cursor = 'pointer';

                        // Display name and profile picture
                        listItem.innerHTML = `
                           
                            ${author.name}
                        `;
                        
                        listItem.addEventListener('click', function() {
                            addAuthorToSelection(author);
                            suggestionsList.innerHTML = '';
                            document.getElementById('author').value = ''; // Clear the input field
                        });

                        suggestionsList.appendChild(listItem);
                    });

                    suggestionsList.style.display = authors.length > 0 ? 'block' : 'none';
                } catch (error) {
                    console.error('Error fetching author suggestions:', error);
                }
            } else {
                document.getElementById('author-suggestions').style.display = 'none';
            }
        });

        function addAuthorToSelection(author) {
            // Check if the researcher ID is already selected
            if (!authorsSelected.some(selected => selected.researcher_id === author.researcher_id)) {
                authorsSelected.push(author);
                updateAuthorInput();
                displaySelectedAuthors();
            }
        }

        function removeAuthor(button) {
            const selectionContainer = document.getElementById('selected-authors');
            const authorNameToRemove = button.parentElement.querySelector('span').textContent;

            // Remove the author by name from the authorsSelected array
            authorsSelected = authorsSelected.filter(author => author.name !== authorNameToRemove);
            updateAuthorInput();
            displaySelectedAuthors();
        }

        function updateAuthorInput() {
            const hiddenInput = document.getElementById('selected_authors');
            // Store only the researcher IDs as a comma-separated string
            hiddenInput.value = authorsSelected.map(author => author.researcher_id).join(', ');
            console.log('Updated hidden input value:', hiddenInput.value); // Debug log
        }

        function displaySelectedAuthors() {
            const selectionContainer = document.getElementById('selected-authors');
            selectionContainer.innerHTML = '';

            authorsSelected.forEach(author => {
                const authorItem = document.createElement('div');
                authorItem.classList.add('author-capsule');
                authorItem.style.display = 'flex';
                authorItem.style.alignItems = 'center';
                authorItem.style.marginBottom = '5px';
                authorItem.innerHTML = `
                    <span>${author.name}</span>
                    <button type="button" onclick="removeAuthor(this)" style="margin-left: 10px; background: none; border: none; cursor: pointer;">&times;</button>
                `;

                selectionContainer.appendChild(authorItem);
            });
        }

        function isAuthorSelected() {
            return authorsSelected.length > 0;
        }

        
    </script>


    <script>
       document.querySelector('#searchForm').addEventListener('submit', async function (e) {
    e.preventDefault(); // Prevent the form from submitting traditionally

    const query = document.querySelector('#searchInput').value;  // This will capture the barcode or query
    const sort = document.querySelector('#sortSelect').value;

    try {
        // Send the search query (could be a title or barcode) and sort to the backend
        const response = await fetch(`/search?query=${encodeURIComponent(query)}&sort=${sort}`);
        const data = await response.json();

        if (data.success) {
            // Clear the results container
            const resultsContainer = document.querySelector('#resultsContainer');
            resultsContainer.innerHTML = '';

            // Display new results
            data.results.forEach(result => {
                const resultItem = document.createElement('div');
                resultItem.classList.add('result-item');
                resultItem.innerHTML = `
                    <h3>${result.title}</h3>
                    <p>Author: ${result.author}</p>
                    <p>Status: ${result.status}</p>
                    <p>Publication Date: ${new Date(result.publication_date).toLocaleDateString()}</p>
                    <p>${result.description}</p>
                `;
                resultsContainer.appendChild(resultItem);
            });
        } else {
            console.error('No results found');
        }
    } catch (error) {
        console.error('Error fetching search results:', error);
    }
});

    </script>




   <script>
    // Populate the modal with the research data
document.getElementById('viewResearchModal').addEventListener('show.bs.modal', function (event) {
    var button = event.relatedTarget; // Button that triggered the modal

    // Get data attributes from the button
    var title = button.getAttribute('data-title');
    
    var author = button.getAttribute('data-author');
    var publicationDate = button.getAttribute('data-publication_date');
    var journalPublication = button.getAttribute('data-journal_publication');
    var status = button.getAttribute('data-status');
    var barcode = button.getAttribute('data-barcode'); // Base64 barcode string
    var doi = button.getAttribute('data-doi');
    var abstract = button.getAttribute('data-abstract');
    var campus = button.getAttribute('data-campus');
    var funding = button.getAttribute('data-funding');
    var nature = button.getAttribute('data-nature');
    var origin = button.getAttribute('data-origin');
    var isbn = button.getAttribute('data-isbn');
    var startdate = button.getAttribute('data-startdate');
    var enddate = button.getAttribute('data-enddate');
    var keyword = button.getAttribute('data-keyword');
    var filename = button.getAttribute('data-filename');
    
    

    // Update modal content
    document.getElementById('view-title').textContent = title;
   
    document.getElementById('view-author').textContent = author;
    document.getElementById('view-publication-date').textContent = publicationDate;
    document.getElementById('view-journal-publication').textContent = journalPublication;
    document.getElementById('view-status').textContent = status;
    document.getElementById('view-doi').textContent = doi;
    document.getElementById('view-abstract').textContent = abstract;
    document.getElementById('view-campus').textContent = campus;
    document.getElementById('view-funding').textContent = funding;
    document.getElementById('view-nature').textContent = nature;
    document.getElementById('view-origin').textContent = origin;
    document.getElementById('view-isbn').textContent = isbn;
    document.getElementById('view-startdate').textContent = startdate;
    document.getElementById('view-enddate').textContent = enddate;
    document.getElementById('view-keyword').textContent = keyword;
    document.getElementById('view-filename').textContent = filename;

    

    // Set the barcode image in the modal
    var barcodeImage = document.getElementById('view-barcode-image');
    barcodeImage.src = "data:image/png;base64," + barcode; // Set the base64 barcode image
});

</script>
    <!-- Include Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
</body>
</html>
